{"code":"import { useEffect } from 'react';\r\nimport { useContextSelector } from 'use-context-selector';\r\nimport { ResponseStateContext } from '../store/responseState/reducer';\r\nimport { ResponseStateCategory } from '../store/responseState/types';\r\nimport { StoreContext } from '../store/rootReducer';\r\nimport { useManualApi } from './useManualApi';\r\nimport { PassengerFieldsFromApi, } from './usePassengersData';\r\nimport useSetResponseState from './useSetResponseState';\r\nimport { basketItemsToTicketTypes, gtmPush } from './utils';\r\n/**\r\n * Adding user credit\r\n */\r\nconst useCredit = (unpaidTickets) => {\r\n    const user = useContextSelector(StoreContext, c => c.state.user);\r\n    const currency = useContextSelector(StoreContext, c => c.state.user.currency);\r\n    const setState = useSetResponseState(ResponseStateCategory.credit);\r\n    const categoryState = useContextSelector(ResponseStateContext, c => c.state[ResponseStateCategory.credit]);\r\n    const [{ error, loading }, fetchAddCredit] = useManualApi({\r\n        url: '/payments/credit/add',\r\n        method: 'POST',\r\n    });\r\n    const addCredit = async (amount, rememberCard, chargeTickets = false, tickets = undefined, fields = {}, signal) => {\r\n        if (user.user) {\r\n            const ticketsCorrelation = chargeTickets\r\n                ? (tickets ? tickets : basketItemsToTicketTypes(unpaidTickets))\r\n                    .map((t) => `${t.type}=${t.id}`)\r\n                    .join('&')\r\n                : null;\r\n            try {\r\n                const payload = {\r\n                    amount: currency === 'EUR' ? parseFloat(amount.toFixed(1)) : amount,\r\n                    currency,\r\n                    paymentMethodCode: user.paymentMethodCode,\r\n                    correlationId: `credit${ticketsCorrelation ? `&${ticketsCorrelation}` : ''}`,\r\n                    formFields: [\r\n                        {\r\n                            fieldType: PassengerFieldsFromApi.email,\r\n                            fieldValue: fields?.email || user.user.email,\r\n                        },\r\n                        fields.firstName && {\r\n                            fieldType: PassengerFieldsFromApi.firstName,\r\n                            fieldValue: fields.firstName,\r\n                        },\r\n                        fields.surname && {\r\n                            fieldType: PassengerFieldsFromApi.surname,\r\n                            fieldValue: fields.surname,\r\n                        }, fields.customerName && {\r\n                            fieldType: PassengerFieldsFromApi.customerName,\r\n                            fieldValue: fields.customerName,\r\n                        }, fields.customerAddress && {\r\n                            fieldType: PassengerFieldsFromApi.customerAddress,\r\n                            fieldValue: fields.customerAddress,\r\n                        },\r\n                    ].filter(Boolean),\r\n                    rememberCard,\r\n                };\r\n                gtmPush({ event: 'ADD_CREDIT', ADD_CREDIT: payload });\r\n                const { data } = await fetchAddCredit({ data: payload, signal });\r\n                return data.payRedirectUrl;\r\n            }\r\n            catch (e) { }\r\n        }\r\n    };\r\n    useEffect(() => {\r\n        setState(error?.response?.data?.message, loading);\r\n    }, [error, loading]);\r\n    return { addCredit, ...categoryState };\r\n};\r\nexport default useCredit;\r\n//# sourceMappingURL=useCredit.js.map","references":["/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/@types/react/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/axios/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/use-context-selector/dist/src/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/responseState/reducer.tsx","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/responseState/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/rootReducer.tsx","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/useManualApi.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/usePassengersData.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/usePayment.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/useSetResponseState.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/useUserTickets.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/utils.ts"],"map":"{\"version\":3,\"file\":\"useCredit.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/hooks/useCredit.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/karelpelcak/Documents/repo/rj-shop-bl/dist/hooks/useCredit.d.ts","writeByteOrderMark":false,"text":"import type { GenericAbortSignal } from 'axios';\r\nimport { PassengerFieldsToSend } from './usePassengersData';\r\nimport { TicketTypeId } from './usePayment';\r\nimport { Tickets } from './useUserTickets';\r\n/**\r\n * Adding user credit\r\n */\r\ndeclare const useCredit: (unpaidTickets: Tickets) => {\r\n    error?: {\r\n        message?: string | undefined;\r\n        errorFields?: import(\"../store/responseState/types\").ErrorFields[] | undefined;\r\n    } | undefined;\r\n    loading: boolean;\r\n    addCredit: (amount: number, rememberCard: boolean, chargeTickets?: boolean, tickets?: TicketTypeId[] | undefined, fields?: Partial<Record<PassengerFieldsToSend, string>>, signal?: GenericAbortSignal) => Promise<string | undefined>;\r\n};\r\nexport default useCredit;\r\n"}}
