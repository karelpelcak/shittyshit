{"code":"import { useEffect } from 'react';\r\nimport { useContextSelector } from 'use-context-selector';\r\nimport { ResponseStateCategory } from '../store/responseState/types';\r\nimport { StoreContext } from '../store/rootReducer';\r\nimport { useManualApi } from './useManualApi';\r\nimport useSetResponseState from './useSetResponseState';\r\nimport { gtmPush } from './utils';\r\nconst useTicketReview = ({ ticketId, luh }) => {\r\n    const setState = useSetResponseState(ResponseStateCategory.ticketReview);\r\n    const token = useContextSelector(StoreContext, c => c.state.user.token);\r\n    const [{ data: authData, loading: authLoading, error: authError }, fetchReviewAuth,] = useManualApi({\r\n        url: `/tickets/authenticate/${luh}`,\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        data: {},\r\n    });\r\n    const [{ loading, ...reviewForm }, fetchReviewForm] = useManualApi({\r\n        url: `tickets/${ticketId}/rating`,\r\n        method: 'GET',\r\n    });\r\n    const [{ loading: putLoading, error }, putReviewForm] = useManualApi({\r\n        url: `tickets/${ticketId}/rating`,\r\n        method: 'PUT',\r\n    });\r\n    const sendReview = async (data, signal) => {\r\n        try {\r\n            await putReviewForm({\r\n                data,\r\n                headers: luh\r\n                    ? { Authorization: `Bearer ${authData?.token}` }\r\n                    : undefined,\r\n                signal,\r\n            });\r\n            gtmPush({ event: 'SENT_REVIEW', SENT_REVIEW: data });\r\n            return true;\r\n        }\r\n        catch {\r\n            return false;\r\n        }\r\n    };\r\n    useEffect(() => {\r\n        const abortController = new AbortController();\r\n        const signal = abortController.signal;\r\n        if (luh && authData?.token) {\r\n            fetchReviewForm({\r\n                headers: { Authorization: `Bearer ${authData?.token}` },\r\n                signal,\r\n            });\r\n        }\r\n        else if (!luh && token) {\r\n            fetchReviewForm({ signal });\r\n        }\r\n        return () => {\r\n            abortController.abort();\r\n        };\r\n    }, [authData?.token]);\r\n    useEffect(() => {\r\n        if (!luh) {\r\n            return;\r\n        }\r\n        const abortController = new AbortController();\r\n        const signal = abortController.signal;\r\n        fetchReviewAuth({ signal });\r\n        return () => {\r\n            abortController.abort();\r\n        };\r\n    }, [luh]);\r\n    useEffect(() => {\r\n        setState(reviewForm.error?.response?.data?.message ||\r\n            authError?.response?.data?.message ||\r\n            error?.response?.data?.message, authLoading || loading || putLoading);\r\n    }, [reviewForm.error, authError, error, loading, authLoading, loading]);\r\n    return {\r\n        reviewForm,\r\n        loading: authLoading || loading || putLoading,\r\n        sendReview,\r\n    };\r\n};\r\nexport default useTicketReview;\r\n//# sourceMappingURL=useTicketReview.js.map","references":["/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/@types/react/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/axios/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/use-context-selector/dist/src/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/responseState/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/rootReducer.tsx","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/useManualApi.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/useSetResponseState.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/utils.ts"],"map":"{\"version\":3,\"file\":\"useTicketReview.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/hooks/useTicketReview.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,SAAS,EAAE,MAAM,OAAO,CAAC;AAElC,OAAO,EAAE,kBAAkB,EAAE,MAAM,sBAAsB,CAAC;AAC1D,OAAO,EAAE,qBAAqB,EAAE,MAAM,8BAA8B,CAAC;AACrE,OAAO,EAAE,YAAY,EAAE,MAAM,sBAAsB,CAAC;AACpD,OAAO,EAAE,YAAY,EAAE,MAAM,gBAAgB,CAAC;AAC9C,OAAO,mBAAmB,MAAM,uBAAuB,CAAC;AACxD,OAAO,EAAE,OAAO,EAAE,MAAM,SAAS,CAAC;AA2ClC,MAAM,eAAe,GAAG,CAAC,EAAE,QAAQ,EAAE,GAAG,EAAsB,EAAE,EAAE;IAChE,MAAM,QAAQ,GAAG,mBAAmB,CAAC,qBAAqB,CAAC,YAAY,CAAC,CAAC;IACzE,MAAM,KAAK,GAAG,kBAAkB,CAAC,YAAY,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAExE,MAAM,CACJ,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,WAAW,EAAE,KAAK,EAAE,SAAS,EAAE,EAC1D,eAAe,EAChB,GAAG,YAAY,CAAoB;QAClC,GAAG,EAAE,yBAAyB,GAAG,EAAE;QACnC,MAAM,EAAE,MAAM;QACd,OAAO,EAAE,EAAE,cAAc,EAAE,kBAAkB,EAAE;QAC/C,IAAI,EAAE,EAAE;KACT,CAAC,CAAC;IAEH,MAAM,CAAC,EAAE,OAAO,EAAE,GAAG,UAAU,EAAE,EAAE,eAAe,CAAC,GAAG,YAAY,CAAW;QAC3E,GAAG,EAAE,WAAW,QAAQ,SAAS;QACjC,MAAM,EAAE,KAAK;KACd,CAAC,CAAC;IAEH,MAAM,CAAC,EAAE,OAAO,EAAE,UAAU,EAAE,KAAK,EAAE,EAAE,aAAa,CAAC,GAAG,YAAY,CAElE;QACA,GAAG,EAAE,WAAW,QAAQ,SAAS;QACjC,MAAM,EAAE,KAAK;KACd,CAAC,CAAC;IAEH,MAAM,UAAU,GAAG,KAAK,EAAE,IAAmB,EAAE,MAA2B,EAAE,EAAE;QAC5E,IAAI;YACF,MAAM,aAAa,CAAC;gBAClB,IAAI;gBACJ,OAAO,EAAE,GAAG;oBACV,CAAC,CAAC,EAAE,aAAa,EAAE,UAAU,QAAQ,EAAE,KAAK,EAAE,EAAE;oBAChD,CAAC,CAAC,SAAS;gBACb,MAAM;aACP,CAAC,CAAC;YACH,OAAO,CAAC,EAAE,KAAK,EAAE,aAAa,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC,CAAC;YACrD,OAAO,IAAI,CAAC;SACb;QAAC,MAAM;YACN,OAAO,KAAK,CAAC;SACd;IACH,CAAC,CAAC;IAEF,SAAS,CAAC,GAAG,EAAE;QACb,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAC;QAC9C,MAAM,MAAM,GAAG,eAAe,CAAC,MAAM,CAAC;QACtC,IAAI,GAAG,IAAI,QAAQ,EAAE,KAAK,EAAE;YAC1B,eAAe,CAAC;gBACd,OAAO,EAAE,EAAE,aAAa,EAAE,UAAU,QAAQ,EAAE,KAAK,EAAE,EAAE;gBACvD,MAAM;aACP,CAAC,CAAC;SACJ;aAAM,IAAI,CAAC,GAAG,IAAI,KAAK,EAAE;YACxB,eAAe,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;SAC7B;QAED,OAAO,GAAG,EAAE;YACV,eAAe,CAAC,KAAK,EAAE,CAAC;QAC1B,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC;IAEtB,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,CAAC,GAAG,EAAE;YACR,OAAO;SACR;QACD,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAC;QAC9C,MAAM,MAAM,GAAG,eAAe,CAAC,MAAM,CAAC;QACtC,eAAe,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;QAC5B,OAAO,GAAG,EAAE;YACV,eAAe,CAAC,KAAK,EAAE,CAAC;QAC1B,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;IAEV,SAAS,CAAC,GAAG,EAAE;QACb,QAAQ,CACN,UAAU,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,OAAO;YACzC,SAAS,EAAE,QAAQ,EAAE,IAAI,EAAE,OAAO;YAClC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,OAAO,EAC9B,WAAW,IAAI,OAAO,IAAI,UAAU,CACrC,CAAC;IACJ,CAAC,EAAE,CAAC,UAAU,CAAC,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,OAAO,EAAE,WAAW,EAAE,OAAO,CAAC,CAAC,CAAC;IAExE,OAAO;QACL,UAAU;QACV,OAAO,EAAE,WAAW,IAAI,OAAO,IAAI,UAAU;QAC7C,UAAU;KACX,CAAC;AACJ,CAAC,CAAC;AAEF,eAAe,eAAe,CAAC\"}","dts":{"name":"/home/karelpelcak/Documents/repo/rj-shop-bl/dist/hooks/useTicketReview.d.ts","writeByteOrderMark":false,"text":"import type { GenericAbortSignal } from 'axios';\r\nexport interface Review {\r\n    sectionId: number;\r\n    fields: QuestionField[];\r\n}\r\nexport interface QuestionField {\r\n    questionId: number;\r\n    type: 'RADIO_BUTTON' | 'TEXT';\r\n    text: string;\r\n    options: Option[];\r\n}\r\nexport interface Option {\r\n    text: string;\r\n    answerId: number;\r\n}\r\nexport interface RatingPayload {\r\n    forms: Form[];\r\n}\r\nexport interface Form {\r\n    sectionId: number;\r\n    form: FormFields;\r\n}\r\nexport interface FormFields {\r\n    fields: AnswerField[];\r\n}\r\nexport interface AnswerField {\r\n    questionId: number;\r\n    text: string;\r\n    answerId?: number | null;\r\n}\r\ninterface TicketReviewParams {\r\n    ticketId: number;\r\n    luh?: string;\r\n}\r\ndeclare const useTicketReview: ({ ticketId, luh }: TicketReviewParams) => {\r\n    reviewForm: {\r\n        data?: Review[] | undefined;\r\n        error: import(\"axios\").AxiosError<any, any> | null;\r\n        response?: import(\"axios\").AxiosResponse<Review[], any> | undefined;\r\n    };\r\n    loading: boolean;\r\n    sendReview: (data: RatingPayload, signal?: GenericAbortSignal) => Promise<boolean>;\r\n};\r\nexport default useTicketReview;\r\n"}}
