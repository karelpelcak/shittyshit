{"code":"import { useContextSelector } from 'use-context-selector';\r\nimport { BookingContext } from '../store/booking/reducer';\r\nimport { CLEAR_BOOKING, REPLACE_TARIFFS, SAVE_CONNECTION, SELECT_ADDONS, SELECT_CLASS, SELECT_CODE_DISCOUNT, SELECT_PERC_DISCOUNT, SELECT_ROUTE, SELECT_SEATS, SET_PRICE, UPSELL_ADDONS, } from '../store/booking/types';\r\nimport { useManualApi } from './useManualApi';\r\nexport const useBookingDiscount = (directionProp = 'there') => {\r\n    const isReturn = useContextSelector(BookingContext, c => c.state.booking?.isReturn);\r\n    const direction = directionProp === 'back' && isReturn ? 'back' : 'there';\r\n    const bookingItem = useContextSelector(BookingContext, c => c.state.booking?.[direction]);\r\n    const dispatch = useContextSelector(BookingContext, c => c.dispatch);\r\n    const [{ error, data }, verifyDiscount] = useManualApi({\r\n        method: 'POST',\r\n    });\r\n    const selectCodeDiscount = async (codeDiscount, signal) => {\r\n        if (!bookingItem) {\r\n            return;\r\n        }\r\n        const { data: discountData } = await verifyDiscount({\r\n            url: typeof codeDiscount === 'number'\r\n                ? `/discounts/percentual/${codeDiscount}/verify`\r\n                : `/discounts/code/${codeDiscount}/verify`,\r\n            data: {\r\n                actionPrice: null,\r\n                passengers: bookingItem.tariffs?.map((tariff) => ({\r\n                    tariff,\r\n                })),\r\n                route: {\r\n                    priceSource: bookingItem.priceSource,\r\n                    routeId: bookingItem.routeId,\r\n                    seatClass: bookingItem.seatClass,\r\n                    sections: bookingItem.sections?.map(({ selectedSeats, ...section }) => ({ section, selectedSeats })),\r\n                },\r\n                ticketPrice: bookingItem.price,\r\n            },\r\n            signal,\r\n        });\r\n        const discountAmount = bookingItem.price - discountData.discountedTicketPrice;\r\n        dispatch({\r\n            type: SET_PRICE,\r\n            payload: { direction, price: discountData.discountedTicketPrice },\r\n        });\r\n        if (typeof codeDiscount === 'number') {\r\n            dispatch({\r\n                type: SELECT_PERC_DISCOUNT,\r\n                payload: {\r\n                    percentualDiscountIds: [codeDiscount],\r\n                    discountAmount,\r\n                    direction,\r\n                },\r\n            });\r\n        }\r\n        else {\r\n            dispatch({\r\n                type: SELECT_CODE_DISCOUNT,\r\n                payload: { codeDiscount, discountAmount, direction },\r\n            });\r\n        }\r\n    };\r\n    return {\r\n        data,\r\n        error,\r\n        selectCodeDiscount,\r\n    };\r\n};\r\nconst useBookingActions = (directionProp = 'there') => {\r\n    const isReturn = useContextSelector(BookingContext, c => c.state.booking?.isReturn);\r\n    const direction = directionProp === 'back' && isReturn ? 'back' : 'there';\r\n    const dispatch = useContextSelector(BookingContext, c => c.dispatch);\r\n    const createBooking = (payload) => dispatch({ type: SAVE_CONNECTION, payload });\r\n    const replaceTariffs = (tariffs) => dispatch({\r\n        type: REPLACE_TARIFFS,\r\n        payload: { direction, tariffs },\r\n    });\r\n    const selectRoute = (payload) => dispatch({\r\n        type: SELECT_ROUTE,\r\n        payload: { ...payload, direction },\r\n    });\r\n    const selectClass = (payload) => dispatch({\r\n        type: SELECT_CLASS,\r\n        payload: { ...payload, direction },\r\n    });\r\n    const selectSeats = (seats) => dispatch({ type: SELECT_SEATS, payload: { seats, direction } });\r\n    const selectAddons = (selectedAddons) => dispatch({\r\n        type: SELECT_ADDONS,\r\n        payload: { selectedAddons, direction },\r\n    });\r\n    const upsellAddons = (selectedAddons) => dispatch({\r\n        type: UPSELL_ADDONS,\r\n        payload: { selectedAddons, direction },\r\n    });\r\n    const clearBooking = (dir) => dispatch({ type: CLEAR_BOOKING, payload: { direction: dir } });\r\n    return {\r\n        clearBooking,\r\n        createBooking,\r\n        replaceTariffs,\r\n        selectAddons,\r\n        selectClass,\r\n        selectRoute,\r\n        selectSeats,\r\n        upsellAddons,\r\n    };\r\n};\r\nexport default useBookingActions;\r\n//# sourceMappingURL=useBooking.js.map","references":["/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/axios/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/use-context-selector/dist/src/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/booking/reducer.tsx","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/booking/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/useAddons.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/useManualApi.ts"],"map":"{\"version\":3,\"file\":\"useBooking.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/hooks/useBooking.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/karelpelcak/Documents/repo/rj-shop-bl/dist/hooks/useBooking.d.ts","writeByteOrderMark":false,"text":"import type { GenericAbortSignal } from 'axios';\r\nimport { ConnectionDirection, SaveConnectionPayload, SelectClassPayload, SelectRoutePayload } from '../store/booking/types';\r\nimport { Currency, SelectedSeat, Tariff } from './types';\r\nimport { SelectedAddon } from './useAddons';\r\nexport interface DiscountResponse {\r\n    amount: number;\r\n    currency: Currency;\r\n    discountedTicketPrice: number;\r\n}\r\nexport declare const useBookingDiscount: (directionProp?: ConnectionDirection) => {\r\n    data: DiscountResponse | undefined;\r\n    error: import(\"axios\").AxiosError<any, any> | null;\r\n    selectCodeDiscount: (codeDiscount: string | number | undefined, signal?: GenericAbortSignal) => Promise<void>;\r\n};\r\ndeclare const useBookingActions: (directionProp?: ConnectionDirection) => {\r\n    clearBooking: (dir?: ConnectionDirection) => void;\r\n    createBooking: (payload: SaveConnectionPayload) => void;\r\n    replaceTariffs: (tariffs: Tariff[]) => void;\r\n    selectAddons: (selectedAddons: SelectedAddon[]) => void;\r\n    selectClass: (payload: Omit<SelectClassPayload, 'direction'>) => void;\r\n    selectRoute: (payload: Omit<SelectRoutePayload, 'direction'>) => void;\r\n    selectSeats: (seats: SelectedSeat[]) => void;\r\n    upsellAddons: (selectedAddons: SelectedAddon[]) => void;\r\n};\r\nexport default useBookingActions;\r\n"}}
