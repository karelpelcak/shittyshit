{"code":"import { useState } from 'react';\r\nimport { isAxiosError } from 'axios';\r\nimport { useContextSelector } from 'use-context-selector';\r\nimport { ResponseStateContext } from '../store/responseState/reducer';\r\nimport { ResponseStateCategory } from '../store/responseState/types';\r\nimport { FAIL_MESSAGE, api, getErrorMessage } from './consts';\r\nimport useSetResponseState from './useSetResponseState';\r\nimport { gtmPush } from './utils';\r\nconst typeToUrl = Object.freeze({\r\n    FLEXI: '/',\r\n    RJ_SEAT: '/tickets/',\r\n    RJ_SRO: '/tickets/RJ_SRO/',\r\n    RJ_TIME: '/tickets/timetickets/',\r\n});\r\nconst useTickets = () => {\r\n    const setState = useSetResponseState(ResponseStateCategory.ticket);\r\n    const categoryState = useContextSelector(ResponseStateContext, c => c.state[ResponseStateCategory.ticket]);\r\n    const [tickets, setTickets] = useState();\r\n    const fetchTickets = async (ticketTypes, signal) => {\r\n        setState(undefined, true);\r\n        if (!ticketTypes.length) {\r\n            setTickets(undefined);\r\n            setState(undefined, false);\r\n            return true;\r\n        }\r\n        const ticketIndices = { RJ_SEAT: [], RJ_TIME: [], RJ_SRO: [], FLEXI: [] };\r\n        ticketTypes.forEach((ticketType, i) => ticketIndices[ticketType.type].push(i));\r\n        try {\r\n            const ticketResponses = await Promise.all(ticketTypes.map(({ id, type }) => api.get(typeToUrl[type] + id, {\r\n                signal,\r\n                headers: type === 'RJ_SEAT' ? { 'Accept': 'application/1.3.0+json' } : undefined,\r\n            })));\r\n            const responses = ticketResponses.map((response) => response.data);\r\n            const fetchedTickets = {\r\n                RJ_SEAT: responses.filter((_, i) => ticketIndices.RJ_SEAT.includes(i)),\r\n                RJ_TIME: responses.filter((_, i) => ticketIndices.RJ_TIME.includes(i)),\r\n                RJ_SRO: responses.filter((_, i) => ticketIndices.RJ_SRO.includes(i)),\r\n            };\r\n            gtmPush({ event: 'BOUGHT_TICKETS', BOUGHT_TICKETS: fetchedTickets });\r\n            setTickets(fetchedTickets);\r\n            setState(undefined, false);\r\n            return true;\r\n        }\r\n        catch (e) {\r\n            setState(isAxiosError(e) ?\r\n                e.response?.data.message || getErrorMessage(e)\r\n                : FAIL_MESSAGE, false);\r\n            return false;\r\n        }\r\n    };\r\n    return { fetchTickets, tickets, ...categoryState };\r\n};\r\nexport default useTickets;\r\n//# sourceMappingURL=useTickets.js.map","references":["/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/@types/react/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/axios/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/use-context-selector/dist/src/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/responseState/reducer.tsx","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/responseState/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/consts.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/usePayment.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/useSetResponseState.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/useUserTickets.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/utils.ts"],"map":"{\"version\":3,\"file\":\"useTickets.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/hooks/useTickets.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/karelpelcak/Documents/repo/rj-shop-bl/dist/hooks/useTickets.d.ts","writeByteOrderMark":false,"text":"import { type GenericAbortSignal } from 'axios';\r\nimport { TicketTypeId } from './usePayment';\r\nimport { Tickets } from './useUserTickets';\r\ndeclare const useTickets: () => {\r\n    error?: {\r\n        message?: string | undefined;\r\n        errorFields?: import(\"../store/responseState/types\").ErrorFields[] | undefined;\r\n    } | undefined;\r\n    loading: boolean;\r\n    fetchTickets: (ticketTypes: TicketTypeId[], signal?: GenericAbortSignal) => Promise<boolean>;\r\n    tickets: Tickets | undefined;\r\n};\r\nexport default useTickets;\r\n"}}
