{"code":"import React, { useEffect, useState, } from 'react';\r\nimport { createContext } from 'use-context-selector';\r\nimport { useImmerReducer } from 'use-immer';\r\nimport { api, reqInterceptor, resInterceptor } from '../hooks/consts';\r\nimport BookingProvider from './booking/reducer';\r\nimport ResponseStateProvider from './responseState/reducer';\r\nimport upsellReducer, { upsellInitialState } from './upsell/reducer';\r\nimport userReducer, { generateUserInitialState, userInitialState, } from './user/reducer';\r\nconst initialStoreContent = {\r\n    dispatch: {\r\n        upsellDispatch: () => { },\r\n        userDispatch: () => { },\r\n    },\r\n    interceptorsMounted: false,\r\n    state: {\r\n        upsell: upsellInitialState,\r\n        user: userInitialState,\r\n    },\r\n};\r\nexport const StoreContext = createContext(initialStoreContent);\r\nconst StoreProvider = ({ children, currency, transportHash, lang = 'cs', persistConfig, persist, }) => {\r\n    const [upsell, upsellDispatch] = useImmerReducer(upsellReducer, persistConfig?.getItem().upsell || upsellInitialState);\r\n    const [user, userDispatch] = useImmerReducer(userReducer, persistConfig?.getItem().user || generateUserInitialState(currency, lang));\r\n    const [interceptorsMounted, setInterceptorsMounted] = useState(false);\r\n    useEffect(() => {\r\n        persistConfig?.setItem({ upsell });\r\n    }, [upsell]);\r\n    useEffect(() => {\r\n        persistConfig?.setItem({ user });\r\n    }, [user]);\r\n    useEffect(() => {\r\n        if (user.token) {\r\n            api.defaults.headers.Authorization = `Bearer ${user.token}`;\r\n        }\r\n        else {\r\n            delete api.defaults.headers.Authorization;\r\n        }\r\n    }, [user.token]);\r\n    useEffect(() => {\r\n        if (user.currency) {\r\n            api.defaults.headers.common['X-Currency'] = user.currency;\r\n        }\r\n    }, [user.currency]);\r\n    useEffect(() => {\r\n        const reqIID = transportHash ? reqInterceptor(transportHash) : undefined;\r\n        const resIID = resInterceptor(() => {\r\n            userDispatch({ type: 'CLEAR_USER' });\r\n        });\r\n        // it was happening that requests would fail because the interceptors weren't mounted\r\n        setInterceptorsMounted(true);\r\n        return () => {\r\n            if (reqIID) {\r\n                api.interceptors.request.eject(reqIID);\r\n            }\r\n            api.interceptors.response.eject(resIID);\r\n        };\r\n    }, []);\r\n    return (React.createElement(StoreContext.Provider, { value: {\r\n            dispatch: {\r\n                upsellDispatch,\r\n                userDispatch,\r\n            },\r\n            interceptorsMounted,\r\n            state: { upsell, user },\r\n        } },\r\n        React.createElement(ResponseStateProvider, { persistConfig: persistConfig, persist: persist?.responseState },\r\n            React.createElement(BookingProvider, { persistConfig: persistConfig, persist: persist?.booking }, children))));\r\n};\r\nexport default StoreProvider;\r\n//# sourceMappingURL=rootReducer.js.map","references":["/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/@types/react/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/use-context-selector/dist/src/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/node_modules/use-immer/dist/index.d.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/index.tsx","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/consts.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/hooks/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/booking/reducer.tsx","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/booking/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/responseState/reducer.tsx","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/responseState/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/upsell/reducer.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/upsell/types.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/user/reducer.ts","/home/karelpelcak/Documents/repo/rj-shop-bl/src/store/user/types.ts"],"map":"{\"version\":3,\"file\":\"rootReducer.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/store/rootReducer.tsx\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/karelpelcak/Documents/repo/rj-shop-bl/dist/store/rootReducer.d.ts","writeByteOrderMark":false,"text":"import { Dispatch, PropsWithChildren } from 'react';\r\nimport { PersistConfig } from '../hooks';\r\nimport { Currency, Language } from '../hooks/types';\r\nimport { BookingReducerProps } from './booking/types';\r\nimport { ResponseStateReducerProps } from './responseState/types';\r\nimport { UpsellActions, UpsellReducerProps } from './upsell/types';\r\nimport { UserActions, UserReducerProps } from './user/types';\r\nexport interface RootReducerProps {\r\n    user: UserReducerProps;\r\n    upsell: UpsellReducerProps;\r\n}\r\nexport interface PersistedState extends RootReducerProps {\r\n    bookings?: BookingReducerProps;\r\n    responseState?: ResponseStateReducerProps;\r\n}\r\nexport declare const StoreContext: import(\"use-context-selector\").Context<{\r\n    state: RootReducerProps;\r\n    interceptorsMounted: boolean;\r\n    dispatch: {\r\n        upsellDispatch: Dispatch<UpsellActions>;\r\n        userDispatch: Dispatch<UserActions>;\r\n    };\r\n}>;\r\nexport interface StoreProviderProps {\r\n    lang?: Language;\r\n    currency: Currency;\r\n    transportHash?: string;\r\n    persistConfig?: PersistConfig;\r\n    persist?: {\r\n        booking?: boolean;\r\n        responseState?: boolean;\r\n    };\r\n    saveConnection?: boolean;\r\n}\r\ndeclare const StoreProvider: ({ children, currency, transportHash, lang, persistConfig, persist, }: PropsWithChildren<StoreProviderProps>) => JSX.Element;\r\nexport default StoreProvider;\r\n"}}
